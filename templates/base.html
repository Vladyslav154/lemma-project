<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ t('LepkO') }}</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div id="trial-banner"></div>

    <div class="nav-button home-button">
        <a href="/?lang={{ lang }}">üè† {{ t('home_button') }}</a>
    </div>

    <div class="nav-button lang-switcher">
        <a href="?lang=ru" class="{% if lang == 'ru' %}active{% endif %}">RU</a>
        <span>|</span>
        <a href="?lang=en" class="{% if lang == 'en' %}active{% endif %}">EN</a>
    </div>

    <div class="main-content">
        {% block content %}
        {% endblock %}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const trialKey = localStorage.getItem('lepko_trial_key');
            const proKey = localStorage.getItem('lepko_pro_key');
            const banner = document.getElementById('trial-banner');
            if (banner && !trialKey && !proKey) {
                fetch('/start-trial', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.trial_key) {
                            localStorage.setItem('lepko_trial_key', data.trial_key);
                            banner.textContent = '‚úÖ –ü—Ä–æ–±–Ω—ã–π Pro-–¥–æ—Å—Ç—É–ø –Ω–∞ 30 –¥–Ω–µ–π –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!';
                            banner.classList.add('active');
                            setTimeout(() => { banner.classList.remove('active'); }, 5000);
                        }
                    }).catch(err => console.error("Failed to start trial:", err));
            }
            const activateButton = document.querySelector('.activate-key-link');
            if (activateButton) {
                activateButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    const enteredKey = prompt("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à Pro –∫–ª—é—á:");
                    if (enteredKey && enteredKey.startsWith("PRO-")) {
                        localStorage.setItem('lepko_pro_key', enteredKey);
                        localStorage.removeItem('lepko_trial_key');
                        alert("Pro-–∫–ª—é—á –ø—Ä–∏–Ω—è—Ç –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ!");
                    } else if (enteredKey) {
                        alert("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞.");
                    }
                });
            }
        });
    </script>
</body>
</html>