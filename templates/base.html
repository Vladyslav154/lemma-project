<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ t('LepkO') }}</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div id="trial-banner"></div>

    <div class="nav-container">
        <div class="nav-button home-button">
            <a href="/?lang={{ lang }}">üè† {{ t('home_button') }}</a>
        </div>
        <div class="nav-button about-button">
            <a href="/about?lang={{ lang }}">‚ÑπÔ∏è {{ t('about_button') }}</a>
        </div>
    </div>

    <div class="nav-button lang-switcher">
        <a href="?lang=ru" class="{% if lang == 'ru' %}active{% endif %}">RU</a>
        <span>|</span>
        <a href="?lang=en" class="{% if lang == 'en' %}active{% endif %}">EN</a>
    </div>

    <div class="main-content">
        {% block content %}
        {% endblock %}
    </div>

    <div id="pro-key-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>{{ t('activate_key') }}</h2>
            <p>{{ t('enter_pro_key_subtitle') }}</p>
            <input type="text" id="pro-key-input" placeholder="PRO-XXXX-XXXX-XXXX">
            <button id="activate-pro-key-button" class="button">{{ t('activate_button') }}</button>
            <p id="modal-status-message"></p>
        </div>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const trialKey = localStorage.getItem('lepko_trial_key');
        const proKey = localStorage.getItem('lepko_pro_key');
        const banner = document.getElementById('trial-banner');

        // –õ–æ–≥–∏–∫–∞ —Ç—Ä–∏–∞–ª–∞ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        if (banner && !trialKey && !proKey) {
            fetch('/start-trial', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.trial_key) {
                        localStorage.setItem('lepko_trial_key', data.trial_key);
                        banner.textContent = '‚úÖ –ü—Ä–æ–±–Ω—ã–π Pro-–¥–æ—Å—Ç—É–ø –Ω–∞ 30 –¥–Ω–µ–π –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!';
                        banner.classList.add('active');
                        setTimeout(() => { banner.classList.remove('active'); }, 5000);
                    }
                }).catch(err => console.error("Failed to start trial:", err));
        }

        // ===== –ù–ê–ß–ê–õ–û –ù–û–í–û–ì–û –ë–õ–û–ö–ê: –õ–æ–≥–∏–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏ Pro-—Å—Ç–∞—Ç—É—Å–∞ =====

        const modal = document.getElementById('pro-key-modal');
        const activateButtons = document.querySelectorAll('.activate-key-link');
        const closeModalButton = document.querySelector('.close-modal');
        const activateProKeyButton = document.getElementById('activate-pro-key-button');
        const proKeyInput = document.getElementById('pro-key-input');
        const modalStatusMessage = document.getElementById('modal-status-message');

        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        activateButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault();
                modal.classList.remove('hidden');
            });
        });

        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const closeModal = () => modal.classList.add('hidden');
        closeModalButton.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        // –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        activateProKeyButton.addEventListener('click', () => {
            const enteredKey = proKeyInput.value.trim();
            if (enteredKey && enteredKey.startsWith("PRO-")) {
                // –ó–¥–µ—Å—å –≤ –±—É–¥—É—â–µ–º –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                localStorage.setItem('lepko_pro_key', enteredKey);
                localStorage.removeItem('lepko_trial_key'); // –£–¥–∞–ª—è–µ–º —Ç—Ä–∏–∞–ª, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
                modalStatusMessage.textContent = "Pro-–∫–ª—é—á —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!";
                modalStatusMessage.style.color = 'var(--primary-color)';
                setTimeout(() => {
                    closeModal();
                    location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å Pro-—Å—Ç–∞—Ç—É—Å
                }, 1500);
            } else {
                modalStatusMessage.textContent = "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–ª—é—á–∞.";
                modalStatusMessage.style.color = '#ff7b72';
            }
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ Pro-–∫–ª—é—á, –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
        if (localStorage.getItem('lepko_pro_key')) {
            const brandBlock = document.querySelector('.brand-block h1');
            if (brandBlock) {
                brandBlock.innerHTML += ' <span class="pro-badge">PRO</span>';
            }
        }
        // ===== –ö–û–ù–ï–¶ –ù–û–í–û–ì–û –ë–õ–û–ö–ê =====
    });
    </script>
</body>
</html>