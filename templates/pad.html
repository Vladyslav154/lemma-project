{% extends "base.html" %}

{% block content %}
<div class="form-container">
    <h1>Общий блокнот</h1>
    <p>Текст здесь будет доступен всем, кто зайдет на эту страницу. Он автоматически синхронизируется между устройствами.</p>
    <textarea id="pad-textarea" placeholder="Начните печатать..."></textarea>
</div>
<style>
    #pad-textarea {
        width: 100%;
        height: 60vh;
        margin-top: 2rem;
        background-color: var(--surface-color-glass);
        color: var(--text-color);
        border: 1px solid var(--border-color-glass);
        border-radius: 15px;
        padding: 1rem;
        font-size: 1rem;
        font-family: 'Inter', sans-serif;
    }
</style>

<script>
    const padTextarea = document.getElementById('pad-textarea');
    
    // Определяем протокол для WebSocket
    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    const wsUrl = `${wsProtocol}//${window.location.host}/ws`;

    const socket = new WebSocket(wsUrl);

    // Обработка входящих сообщений от сервера
    socket.onmessage = function(event) {
        // Чтобы не зацикливать, обновляем текст, только если он отличается
        if (padTextarea.value !== event.data) {
            padTextarea.value = event.data;
        }
    };

    // Отправка сообщений на сервер при вводе текста
    padTextarea.oninput = function() {
        socket.send(padTextarea.value);
    };

    socket.onopen = function(event) {
        console.log("WebSocket connection opened.");
    };

    socket.onclose = function(event) {
        console.log("WebSocket connection closed.");
    };

    socket.onerror = function(error) {
        console.error("WebSocket error:", error);
    };

</script>
{% endblock %}