{% extends "base.html" %}

{% block content %}
<div class="form-container">
    <h1>Общий блокнот</h1>
    <p>Вы находитесь в комнате: <strong>{{ room_id }}</strong>. Отправьте эту ссылку друзьям, чтобы писать здесь вместе.</p>
    <textarea id="pad-textarea" placeholder="Начните печатать..."></textarea>
</div>
<style>
    #pad-textarea {
        width: 100%;
        height: 60vh;
        margin-top: 2rem;
        background-color: var(--surface-color-glass);
        color: var(--text-color);
        border: 1px solid var(--border-color-glass);
        border-radius: 15px;
        padding: 1rem;
        font-size: 1rem;
        font-family: 'Inter', sans-serif;
    }
</style>

<script>
    const padTextarea = document.getElementById('pad-textarea');
    const room_id = "{{ room_id }}"; // Получаем ID комнаты из шаблона
    
    const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    // Создаем WebSocket URL с ID комнаты
    const wsUrl = `${wsProtocol}//${window.location.host}/ws/${room_id}`;

    const socket = new WebSocket(wsUrl);

    socket.onmessage = function(event) {
        if (padTextarea.value !== event.data) {
            padTextarea.value = event.data;
        }
    };

    padTextarea.oninput = function() {
        socket.send(padTextarea.value);
    };

</script>
{% endblock %}